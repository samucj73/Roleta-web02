<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Previsor de Números da Roleta</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.3/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f6f9;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    h1 {
      color: #2c3e50;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .hidden {
      display: none;
    }
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background: #3498db;
      color: white;
      cursor: pointer;
      margin-top: 10px;
      margin-right: 10px;
    }
    button:hover {
      background: #2980b9;
    }
  </style>
</head>
<body>
  <h1>Previsor de Números da Roleta</h1>
  <div class="card">
    <input type="file" accept="image/*" onchange="handleFile(this)" />
    <br />
    <button onclick="gerarPDF()">Gerar PDF</button>
    <button onclick="resetar()">Resetar</button>
    <p id="status" class="hidden">Processando imagem...</p>
  </div>
  <div id="resultados" class="card hidden"></div>
  <div id="graficos" class="card hidden"><canvas id="graficoFrequencia"></canvas></div>
  <div id="previsoesIA" class="card hidden"></div>

  <script>
    let numerosExtraidos = [];

    function handleFile(input) {
      const file = input.files[0];
      if (!file) return;

      document.getElementById("status").classList.remove("hidden");
      document.getElementById("resultados").classList.add("hidden");
      document.getElementById("graficos").classList.add("hidden");
      document.getElementById("previsoesIA").classList.add("hidden");

      const reader = new FileReader();
      reader.onload = function (e) {
        Tesseract.recognize(e.target.result, 'eng', { logger: m => console.log(m) })
          .then(({ data: { text } }) => {
            numerosExtraidos = Array.from(text.matchAll(/\d+/g)).map(n => parseInt(n[0]));
            document.getElementById("status").classList.add("hidden");
            analisarNumeros(numerosExtraidos);
          });
      };
      reader.readAsDataURL(file);
    }

    function analisarNumeros(numeros) {
      if (!numeros.length) return;

      const total = numeros.length;
      const soma = numeros.reduce((a, b) => a + b, 0);
      const media = (soma / total).toFixed(2);
      const moda = numeros.sort((a,b) =>
        numeros.filter(v => v===a).length - numeros.filter(v => v===b).length
      ).pop();
      const mediana = numeros.sort((a, b) => a - b)[Math.floor(total / 2)];
      const desvio = Math.sqrt(numeros.map(n => Math.pow(n - media, 2)).reduce((a, b) => a + b) / total).toFixed(2);
      const pares = numeros.filter(n => n % 2 === 0).length;
      const impares = total - pares;

      const resultadoHTML = `<h3>Análise Matemática</h3>
        <p><strong>Total:</strong> ${total}</p>
        <p><strong>Média:</strong> ${media}</p>
        <p><strong>Moda:</strong> ${moda}</p>
        <p><strong>Mediana:</strong> ${mediana}</p>
        <p><strong>Desvio Padrão:</strong> ${desvio}</p>
        <p><strong>Pares:</strong> ${pares} | <strong>Ímpares:</strong> ${impares}</p>`;

      document.getElementById("resultados").innerHTML = resultadoHTML;
      document.getElementById("resultados").classList.remove("hidden");

      desenharGrafico(numeros);
      previsaoIA(numeros);
    }

    function desenharGrafico(numeros) {
      const contagem = {};
      numeros.forEach(n => contagem[n] = (contagem[n] || 0) + 1);
      const labels = Object.keys(contagem);
      const valores = Object.values(contagem);
      const ctx = document.getElementById("graficoFrequencia").getContext("2d");
      new Chart(ctx, {
        type: "bar",
        data: {
          labels: labels,
          datasets: [{
            label: "Frequência dos Números",
            data: valores,
            backgroundColor: "#3498db"
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            title: { display: true, text: "Distribuição dos Números" }
          }
        }
      });
      document.getElementById("graficos").classList.remove("hidden");
    }

    function previsaoIA(numeros) {
      const frequencia = {};
      numeros.forEach(n => frequencia[n] = (frequencia[n] || 0) + 1);
      const pesos = {};
      const ultimos = numeros.slice(-10);
      numeros.forEach(n => {
        const base = frequencia[n] || 1;
        const boost = ultimos.includes(n) ? 2 : 1;
        pesos[n] = (pesos[n] || 0) + base * boost;
      });
      const sugestoes = Object.entries(pesos)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10)
        .map(n => n[0]);

      document.getElementById("previsoesIA").innerHTML =
        `<h3>Previsão com IA</h3><p>Top 10 mais prováveis:</p><p><strong>${sugestoes.join(", ")}</strong></p>`;
      document.getElementById("previsoesIA").classList.remove("hidden");
    }

    function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      let y = 10;
      doc.setFontSize(16);
      doc.text("Relatório de Análise da Roleta", 20, y);
      y += 10;
      const resultados = document.getElementById("resultados").innerText;
      const previsoes = document.getElementById("previsoesIA").innerText;
      doc.setFontSize(12);
      doc.text(resultados, 20, y);
      y += resultados.split('\n').length * 7;
      doc.addPage();
      doc.text(previsoes, 20, 20);
      const canvas = document.getElementById("graficoFrequencia");
      const imgData = canvas.toDataURL("image/png", 1.0);
      doc.addPage();
      doc.setFontSize(14);
      doc.text("Gráfico de Frequência dos Números", 20, 20);
      doc.addImage(imgData, "PNG", 15, 30, 180, 100);
      doc.save("analise_roleta.pdf");
    }

    function resetar() {
      numerosExtraidos = [];
      document.getElementById("resultados").innerHTML = "";
      document.getElementById("graficos").innerHTML = '<canvas id="graficoFrequencia"></canvas>';
      document.getElementById("previsoesIA").innerHTML = "";
      document.getElementById("resultados").classList.add("hidden");
      document.getElementById("graficos").classList.add("hidden");
      document.getElementById("previsoesIA").classList.add("hidden");
      document.getElementById("status").classList.add("hidden");
    }
  </script>
</body>
</html>
