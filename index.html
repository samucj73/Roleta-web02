<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Previsor Inteligente de Roleta</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tesseract OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.3/dist/tesseract.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0/dist/tf.min.js"></script>
  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0 auto;
      padding: 20px;
      max-width: 900px;
      background: #f4f7f9;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #1a73e8;
    }
    .card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    button {
      margin: 10px 0;
      padding: 10px 20px;
      background: #1a73e8;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    input[type="file"] {
      margin-top: 10px;
    }
    canvas {
      margin: 20px 0;
      width: 100% !important;
    }
    .flex {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .flex > div {
      flex: 1 1 250px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>

  <h1>Previsor Inteligente de Roleta</h1>

  <div class="card">
    <p>Envie uma imagem JPEG com os números:</p>
    <input type="file" accept="image/*" onchange="handleFile(this)">
    <p id="status"></p>
  </div>

  <div class="card" id="analises" style="display:none;">
    <h2>Análises Estatísticas</h2>
    <div id="resultados"></div>
    <div class="flex">
      <canvas id="chartFrequencia"></canvas>
      <canvas id="chartCold"></canvas>
    </div>
    <div class="flex">
      <canvas id="chartParImpar"></canvas>
      <canvas id="chartFaixas"></canvas>
    </div>
    <button onclick="gerarPDF()">Baixar PDF com Resultados</button>
    <button onclick="resetar()">Resetar Análises</button>
  </div>

  <script>
    let numerosExtraidos = [];

    function handleFile(input) {
      const file = input.files[0];
      if (!file) return;
      document.getElementById("status").innerText = "Lendo imagem...";
      Tesseract.recognize(file, 'eng').then(({ data: { text } }) => {
        const numeros = Array.from(text.matchAll(/\d+/g)).map(n => parseInt(n[0]));
        numerosExtraidos = numeros;
        document.getElementById("status").innerText = "Números extraídos!";
        processarAnalises(numeros);
      });
    }

    function processarAnalises(numeros) {
      if (!numeros.length) return;

      document.getElementById("analises").style.display = "block";
      const resultados = document.getElementById("resultados");
      resultados.innerHTML = `
        <p><strong>Total de números:</strong> ${numeros.length}</p>
        <p><strong>Média:</strong> ${media(numeros).toFixed(2)}</p>
        <p><strong>Mediana:</strong> ${mediana(numeros)}</p>
        <p><strong>Moda:</strong> ${moda(numeros).join(', ')}</p>
        <p><strong>Desvio Padrão:</strong> ${desvioPadrao(numeros).toFixed(2)}</p>
        <p><strong>Cold Numbers:</strong> ${coldNumbers(numeros).join(', ')}</p>
      `;

      gerarGraficos(numeros);
      treinarIA(numeros);
    }

    function resetar() {
      location.reload();
    }

    // Funções de análise
    function media(arr) {
      return arr.reduce((a, b) => a + b) / arr.length;
    }

    function mediana(arr) {
      const sorted = [...arr].sort((a, b) => a - b);
      const mid = Math.floor(sorted.length / 2);
      return sorted.length % 2 === 0 ? (sorted[mid - 1] + sorted[mid]) / 2 : sorted[mid];
    }

    function moda(arr) {
      const freq = {};
      arr.forEach(v => freq[v] = (freq[v] || 0) + 1);
      const maxFreq = Math.max(...Object.values(freq));
      return Object.keys(freq).filter(k => freq[k] === maxFreq);
    }

    function desvioPadrao(arr) {
      const m = media(arr);
      return Math.sqrt(arr.reduce((acc, val) => acc + (val - m) ** 2, 0) / arr.length);
    }

    function coldNumbers(arr) {
      const freq = {};
      arr.forEach(n => freq[n] = (freq[n] || 0) + 1);
      const sorted = Object.entries(freq).sort((a, b) => a[1] - b[1]);
      return sorted.slice(0, 5).map(entry => entry[0]);
    }
    function gerarGraficos(numeros) {
      const ctxF = document.getElementById('chartFrequencia').getContext('2d');
      const ctxC = document.getElementById('chartCold').getContext('2d');
      const ctxP = document.getElementById('chartParImpar').getContext('2d');
      const ctxFaixa = document.getElementById('chartFaixas').getContext('2d');

      const freq = {};
      numeros.forEach(n => freq[n] = (freq[n] || 0) + 1);
      const labels = Object.keys(freq);
      const data = Object.values(freq);

      new Chart(ctxF, {
        type: 'bar',
        data: {
          labels,
          datasets: [{ label: 'Frequência', data, backgroundColor: '#1a73e8' }]
        }
      });

      const cold = coldNumbers(numeros);
      new Chart(ctxC, {
        type: 'bar',
        data: {
          labels: cold,
          datasets: [{ label: 'Cold Numbers', data: cold.map(n => freq[n] || 0), backgroundColor: '#e53935' }]
        }
      });

      const pares = numeros.filter(n => n % 2 === 0).length;
      const impares = numeros.length - pares;
      new Chart(ctxP, {
        type: 'pie',
        data: {
          labels: ['Pares', 'Ímpares'],
          datasets: [{
            data: [pares, impares],
            backgroundColor: ['#4caf50', '#fbc02d']
          }]
        }
      });

      const faixas = [0, 12, 24, 36];
      const faixaLabels = ['0-12', '13-24', '25-36'];
      const faixaContagem = [0, 0, 0];
      numeros.forEach(n => {
        if (n >= 0 && n <= 12) faixaContagem[0]++;
        else if (n <= 24) faixaContagem[1]++;
        else if (n <= 36) faixaContagem[2]++;
      });
      new Chart(ctxFaixa, {
        type: 'doughnut',
        data: {
          labels: faixaLabels,
          datasets: [{
            data: faixaContagem,
            backgroundColor: ['#2196f3', '#00bcd4', '#9c27b0']
          }]
        }
      });
    }

    async function treinarIA(numeros) {
      if (numeros.length < 20) return;

      const seqs = [];
      for (let i = 0; i < numeros.length - 5; i++) {
        seqs.push(numeros.slice(i, i + 5));
      }

      const xs = tf.tensor2d(seqs.map(s => s.slice(0, 4)));
      const ys = tf.tensor2d(seqs.map(s => [s[4]]));

      const model = tf.sequential();
      model.add(tf.layers.dense({ units: 64, inputShape: [4], activation: 'relu' }));
      model.add(tf.layers.dense({ units: 64, activation: 'relu' }));
      model.add(tf.layers.dense({ units: 1 }));

      model.compile({ loss: 'meanSquaredError', optimizer: 'adam' });
      await model.fit(xs, ys, { epochs: 50, verbose: 0 });

      const ultimaSeq = numeros.slice(-4);
      const entrada = tf.tensor2d([ultimaSeq]);
      const pred = model.predict(entrada);
      const valorPrevisto = Math.round(pred.dataSync()[0]);

      const div = document.createElement("p");
      div.innerHTML = `<strong>Previsão com IA (próximo número):</strong> ${valorPrevisto}`;
      document.getElementById("resultados").appendChild(div);
    }

    async function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      pdf.setFontSize(16);
      pdf.text("Previsor Inteligente de Roleta", 15, 20);

      const stats = document.getElementById("resultados").innerText.split('\n');
      let y = 30;
      stats.forEach(line => {
        pdf.setFontSize(12);
        pdf.text(line, 15, y);
        y += 8;
      });

      const charts = ["chartFrequencia", "chartCold", "chartParImpar", "chartFaixas"];
      for (let i = 0; i < charts.length; i++) {
        const canvas = document.getElementById(charts[i]);
        const imgData = canvas.toDataURL("image/png");
        if (i !== 0) pdf.addPage();
        pdf.addImage(imgData, 'PNG', 10, 20, 180, 100);
      }

      pdf.save("analise_roleta.pdf");
    }
      function gerarGraficos(numeros) {
      const ctxF = document.getElementById('chartFrequencia').getContext('2d');
      const ctxC = document.getElementById('chartCold').getContext('2d');
      const ctxP = document.getElementById('chartParImpar').getContext('2d');
      const ctxFaixa = document.getElementById('chartFaixas').getContext('2d');

      const freq = {};
      numeros.forEach(n => freq[n] = (freq[n] || 0) + 1);
      const labels = Object.keys(freq);
      const data = Object.values(freq);

      new Chart(ctxF, {
        type: 'bar',
        data: {
          labels,
          datasets: [{ label: 'Frequência', data, backgroundColor: '#1a73e8' }]
        }
      });

      const cold = coldNumbers(numeros);
      new Chart(ctxC, {
        type: 'bar',
        data: {
          labels: cold,
          datasets: [{ label: 'Cold Numbers', data: cold.map(n => freq[n] || 0), backgroundColor: '#e53935' }]
        }
      });

      const pares = numeros.filter(n => n % 2 === 0).length;
      const impares = numeros.length - pares;
      new Chart(ctxP, {
        type: 'pie',
        data: {
          labels: ['Pares', 'Ímpares'],
          datasets: [{
            data: [pares, impares],
            backgroundColor: ['#4caf50', '#fbc02d']
          }]
        }
      });

      const faixas = [0, 12, 24, 36];
      const faixaLabels = ['0-12', '13-24', '25-36'];
      const faixaContagem = [0, 0, 0];
      numeros.forEach(n => {
        if (n >= 0 && n <= 12) faixaContagem[0]++;
        else if (n <= 24) faixaContagem[1]++;
        else if (n <= 36) faixaContagem[2]++;
      });
      new Chart(ctxFaixa, {
        type: 'doughnut',
        data: {
          labels: faixaLabels,
          datasets: [{
            data: faixaContagem,
            backgroundColor: ['#2196f3', '#00bcd4', '#9c27b0']
          }]
        }
      });
    }

    async function treinarIA(numeros) {
      if (numeros.length < 20) return;

      const seqs = [];
      for (let i = 0; i < numeros.length - 5; i++) {
        seqs.push(numeros.slice(i, i + 5));
      }

      const xs = tf.tensor2d(seqs.map(s => s.slice(0, 4)));
      const ys = tf.tensor2d(seqs.map(s => [s[4]]));

      const model = tf.sequential();
      model.add(tf.layers.dense({ units: 64, inputShape: [4], activation: 'relu' }));
      model.add(tf.layers.dense({ units: 64, activation: 'relu' }));
      model.add(tf.layers.dense({ units: 1 }));

      model.compile({ loss: 'meanSquaredError', optimizer: 'adam' });
      await model.fit(xs, ys, { epochs: 50, verbose: 0 });

      const ultimaSeq = numeros.slice(-4);
      const entrada = tf.tensor2d([ultimaSeq]);
      const pred = model.predict(entrada);
      const valorPrevisto = Math.round(pred.dataSync()[0]);

      const div = document.createElement("p");
      div.innerHTML = `<strong>Previsão com IA (próximo número):</strong> ${valorPrevisto}`;
      document.getElementById("resultados").appendChild(div);
    }

    async function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      pdf.setFontSize(16);
      pdf.text("Previsor Inteligente de Roleta", 15, 20);

      const stats = document.getElementById("resultados").innerText.split('\n');
      let y = 30;
      stats.forEach(line => {
        pdf.setFontSize(12);
        pdf.text(line, 15, y);
        y += 8;
      });

      const charts = ["chartFrequencia", "chartCold", "chartParImpar", "chartFaixas"];
      for (let i = 0; i < charts.length; i++) {
        const canvas = document.getElementById(charts[i]);
        const imgData = canvas.toDataURL("image/png");
        if (i !== 0) pdf.addPage();
        pdf.addImage(imgData, 'PNG', 10, 20, 180, 100);
      }

      pdf.save("analise_roleta.pdf");
    }
  </script>
    // Continuação vem na próxima mensagem...
  </script>
</body>
</html>
