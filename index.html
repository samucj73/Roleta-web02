<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Previsor de Roleta com IA – Moderno & Responsivo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Bibliotecas -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.3/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.18.0/dist/tf.min.js"></script>
  <!-- Estilos modernos e responsivos -->
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0; 
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #eef2f7;
      color: #333;
    }
    .container {
      max-width: 960px;
      margin: 20px auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    header {
      text-align: center;
      margin-bottom: 20px;
    }
    header h1 {
      color: #007bff;
      margin: 0;
    }
    .controls {
      text-align: center;
      margin-bottom: 20px;
    }
    .controls input[type="file"] {
      margin: 10px auto;
      display: block;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .controls button {
      padding: 12px 24px;
      font-size: 16px;
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }
    .controls button:hover {
      background: #0056b3;
    }
    .section {
      margin-top: 30px;
    }
    .loading {
      text-align: center;
      color: green;
      font-weight: bold;
    }
    /* Layout responsivo para gráficos */
    .charts {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }
    .charts canvas {
      flex: 1 1 300px;
      max-width: 300px;
    }
    @media (max-width: 600px) {
      .charts canvas {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container" id="relatorio">
    <header>
      <h1>Previsor de Números da Roleta com IA</h1>
    </header>
    <div class="controls">
      <input type="file" accept="image/*" onchange="handleFile(this)">
      <button onclick="gerarPDF()">Baixar Relatório em PDF</button>
    </div>
    <!-- Seções de resultados (a imagem original não será exibida) -->
    <div class="section" id="output"></div>
    <div class="section" id="analises"></div>
    <div class="charts">
      <canvas id="graficoFrequencia"></canvas>
      <canvas id="graficoParImpar"></canvas>
      <canvas id="graficoZonas"></canvas>
    </div>
    <div class="section" id="padroes"></div>
    <div class="section" id="ia-previsao"></div>
  </div>

<script>
// Função para lidar com o upload do arquivo
function handleFile(input) {
  const file = input.files[0];
  if (!file) return;

  const img = new Image();
  const reader = new FileReader();
  reader.onload = function(e) {
    img.onload = () => processImage(img);
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

// Pré-processamento da imagem: redimensionar, converter para escala de cinza e aumentar contraste.
function processImage(img) {
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");
  const scale = 1.5; // Aumenta tamanho para melhor OCR
  canvas.width = img.width * scale;
  canvas.height = img.height * scale;
  // Aplicando filtros: converter em escala de cinza e aumentar contraste
  ctx.filter = "grayscale(100%) contrast(150%)";
  ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

  document.getElementById("output").innerHTML = '<p class="loading">Executando OCR na imagem...</p>';
  
  // Usando Tesseract.js com configurações ajustadas
  Tesseract.recognize(canvas.toDataURL(), 'eng', {
    tessedit_char_whitelist: '0123456789',
    psm: 6
  }).then(({ data: { text } }) => {
    const numeros = Array.from(text.matchAll(/\d+/g)).map(n => parseInt(n[0]));
    mostrarAnalises(numeros);
  });
}

// Função para analisar números, gerar gráficos e extrair padrões
function mostrarAnalises(numeros) {
  if (numeros.length === 0) {
    document.getElementById("output").innerHTML = "<p style='color:red; text-align:center;'>Nenhum número identificado.</p>";
    return;
  }

  // Removendo exibição da imagem (análise invisível ao usuário)
  document.getElementById("output").innerHTML = "";

  // Análise básica: contar ocorrências, identificar top números e calcular estatísticas
  const contagem = {};
  numeros.forEach(n => contagem[n] = (contagem[n] || 0) + 1);
  const top10 = Object.entries(contagem).sort((a, b) => b[1] - a[1]).slice(0, 10).map(e => e[0]);

  const pares = numeros.filter(n => n % 2 === 0).length;
  const impares = numeros.length - pares;
  const zonas = { baixa: 0, media: 0, alta: 0 };
  numeros.forEach(n => {
    if (n >= 1 && n <= 12) zonas.baixa++;
    else if (n >= 13 && n <= 24) zonas.media++;
    else if (n >= 25 && n <= 36) zonas.alta++;
  });

  // Exibindo análise textual
  document.getElementById("analises").innerHTML = `
    <h3>Top 10 Números Frequentes</h3>
    <p>${top10.join(", ")}</p>
  `;

  // Gerando gráficos com Chart.js
  new Chart(document.getElementById("graficoFrequencia").getContext("2d"), {
    type: 'bar',
    data: {
      labels: Object.keys(contagem),
      datasets: [{ label: 'Frequência', data: Object.values(contagem), backgroundColor: '#007bff' }]
    },
    options: { responsive: true, scales: { y: { beginAtZero: true } } }
  });

  new Chart(document.getElementById("graficoParImpar").getContext("2d"), {
    type: 'pie',
    data: {
      labels: ['Pares', 'Ímpares'],
      datasets: [{ data: [pares, impares], backgroundColor: ['#28a745', '#dc3545'] }]
    },
    options: { responsive: true }
  });

  new Chart(document.getElementById("graficoZonas").getContext("2d"), {
    type: 'doughnut',
    data: {
      labels: ['1-12', '13-24', '25-36'],
      datasets: [{ data: [zonas.baixa, zonas.media, zonas.alta], backgroundColor: ['#ffc107', '#17a2b8', '#6f42c1'] }]
    },
    options: { responsive: true }
  });

  // Detectar padrões: repetições e sequências
  const padroesTexto = detectarPadroes(numeros);
  document.getElementById("padroes").innerHTML = `<h3>Padrões Detectados</h3><p>${padroesTexto}</p>`;

  // Previsão "IA" simples (baseada na frequência)
  const previsao = preverIA(numeros);
  document.getElementById("ia-previsao").innerHTML = `<h3>Previsão por IA</h3><p><strong>Próximos 10 números:</strong> ${previsao.join(", ")}</p>`;
}

// Função para detectar padrões simples
function detectarPadroes(numeros) {
  const repetidos = numeros.filter((v, i, a) => a.indexOf(v) !== i);
  const ordenados = [...numeros].sort((a, b) => a - b);
  return `Repetidos: ${[...new Set(repetidos)].join(", ")} | Ordem Crescente: ${ordenados.join(", ")}`;
}

// Função para previsão por IA (modelo simples baseado na frequência dos números)
function preverIA(numeros) {
  const freq = {};
  numeros.forEach(n => freq[n] = (freq[n] || 0) + 1);
  return Object.entries(freq).sort((a, b) => b[1] - a[1]).slice(0, 10).map(e => e[0]);
}

// Geração de PDF com todos os resultados e gráficos (sem a imagem original)
function gerarPDF() {
  const options = {
    margin:       0.5,
    filename:     'relatorio_roleta.pdf',
    image:        { type: 'jpeg', quality: 0.95 },
    html2canvas:  { scale: 2 },
    jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
  };
  html2pdf().set(options).from(document.getElementById('relatorio')).save();
}
</script>
</body>
</html>
